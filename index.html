<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FaceCall</title>
<style>
  body { margin: 0; font-family: sans-serif; background: #222; color: #fff; display: flex; flex-direction: column; align-items: center; }
  #controls { position: absolute; top: 10px; display: flex; gap: 10px; z-index: 10; }
  #videos { position: relative; width: 100vw; height: 100vh; background: #000; display: flex; justify-content: center; align-items: center; }
  video { background: #000; object-fit: cover; }
  #remoteVideo { width: 100%; height: 100%; }
  #localVideo { width: 200px; height: 150px; position: absolute; bottom: 20px; right: 20px; border: 2px solid #fff; z-index: 5; }
  input, button { padding: 5px 10px; font-size: 16px; }
</style>
</head>
<body>

<div id="controls">
  <button id="generateIdBtn">Generate Your ID</button>
  <input type="text" id="peerIdInput" placeholder="Peer ID to call">
  <button id="callBtn">Call</button>
  <button id="endCallBtn">End Call</button>
  <button id="muteBtn">Mute/Unmute</button>
  <span>Your ID: <strong id="myId"></strong></span>
</div>

<div id="videos">
  <video id="remoteVideo" autoplay playsinline></video>
  <video id="localVideo" autoplay muted playsinline></video>
</div>

<script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
let localStream, currentCall, muted = false;
const localVideo = document.getElementById('localVideo');
const remoteVideo = document.getElementById('remoteVideo');
const myIdSpan = document.getElementById('myId');

const generateIdBtn = document.getElementById('generateIdBtn');
const callBtn = document.getElementById('callBtn');
const peerIdInput = document.getElementById('peerIdInput');
const endCallBtn = document.getElementById('endCallBtn');
const muteBtn = document.getElementById('muteBtn');

let peer;

async function initLocalStream() {
    localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    localVideo.srcObject = localStream;
}

// Generate PeerJS ID
generateIdBtn.onclick = async () => {
    await initLocalStream();
    peer = new Peer(undefined, {
        host: 'peerjs.com', port: 443, secure: true
    });

    peer.on('open', id => {
        myIdSpan.textContent = id;
    });

    peer.on('call', call => {
        currentCall = call;
        call.answer(localStream);
        call.on('stream', remoteStream => remoteVideo.srcObject = remoteStream);
        call.on('close', () => remoteVideo.srcObject = null);
    });
};

// Make a call
callBtn.onclick = () => {
    const remoteId = peerIdInput.value.trim();
    if (!remoteId || !localStream) return alert("Generate ID and enter a peer ID");
    currentCall = peer.call(remoteId, localStream);
    currentCall.on('stream', remoteStream => remoteVideo.srcObject = remoteStream);
    currentCall.on('close', () => remoteVideo.srcObject = null);
};

// End call
endCallBtn.onclick = () => {
    if (currentCall) currentCall.close();
    remoteVideo.srcObject = null;
};

// Mute/Unmute
muteBtn.onclick = () => {
    if (!localStream) return;
    localStream.getAudioTracks()[0].enabled = muted;
    muted = !muted;
};
</script>

</body>
</html>