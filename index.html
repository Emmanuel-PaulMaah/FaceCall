<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FaceCall</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="controls">
  <button id="generateIdBtn">Generate My ID</button>
  <input type="text" id="peerIdInput" placeholder="Peer ID to call">
  <button id="callBtn">Call</button>
  <button id="endCallBtn">End Call</button>
  <button id="muteBtn">Mute/Unmute</button>
  <span>Your ID: <strong id="myId"></strong></span>
  <button id="copyIdBtn">Copy ID</button>
</div>

<div id="videos">
  <video id="remoteVideo" autoplay playsinline></video>
  <video id="localVideo" autoplay muted playsinline></video>
</div>

<script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
let localStream, currentCall, muted = false;
const localVideo = document.getElementById('localVideo');
const remoteVideo = document.getElementById('remoteVideo');
const myIdSpan = document.getElementById('myId');

const generateIdBtn = document.getElementById('generateIdBtn');
const callBtn = document.getElementById('callBtn');
const peerIdInput = document.getElementById('peerIdInput');
const endCallBtn = document.getElementById('endCallBtn');
const muteBtn = document.getElementById('muteBtn');
const copyIdBtn = document.getElementById('copyIdBtn');

const marvelCharacters = ["IronMan","SpiderMan","Thor","Hulk","BlackWidow","DoctorStrange","BlackPanther","CaptainAmerica","ScarletWitch","Vision"];
const digits = ["0","1","2","3","4","5","6","7","8","9"];

let peer;

function generateMarvelId() {
    const char = marvelCharacters[Math.floor(Math.random() * marvelCharacters.length)];
    const d1 = digits[Math.floor(Math.random() * digits.length)];
    const d2 = digits[Math.floor(Math.random() * digits.length)];
    return char + d1 + d2;
}

async function initLocalStream() {
    localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    localVideo.srcObject = localStream;
}

// Generate PeerJS ID using Marvel + 2 digits
generateIdBtn.onclick = async () => {
    await initLocalStream();

    const marvelId = generateMarvelId();
    peer = new Peer(marvelId, { debug: 2 });

    peer.on('open', id => {
        myIdSpan.textContent = id;
        console.log('My Peer ID:', id);
    });

    peer.on('call', call => {
        currentCall = call;
        call.answer(localStream);
        call.on('stream', remoteStream => remoteVideo.srcObject = remoteStream);
        call.on('close', () => remoteVideo.srcObject = null);
    });

    peer.on('error', err => alert('PeerJS error: ' + err));
};

// Make a call
callBtn.onclick = () => {
    const remoteId = peerIdInput.value.trim();
    if (!remoteId || !localStream) return alert("Generate ID and enter a peer ID");
    currentCall = peer.call(remoteId, localStream);
    currentCall.on('stream', remoteStream => remoteVideo.srcObject = remoteStream);
    currentCall.on('close', () => remoteVideo.srcObject = null);
};

// End call
endCallBtn.onclick = () => {
    if (currentCall) currentCall.close();
    remoteVideo.srcObject = null;
};

// Mute/Unmute
muteBtn.onclick = () => {
    if (!localStream) return;
    localStream.getAudioTracks()[0].enabled = muted;
    muted = !muted;
};

// Copy Peer ID
copyIdBtn.onclick = () => {
    if (!peer || !peer.id) return alert("Generate your ID first");
    navigator.clipboard.writeText(peer.id).then(() => alert("ID copied!"));
};
</script>

</body>
</html>